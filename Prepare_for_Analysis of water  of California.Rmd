---
title: "Analysis of pH data in water. CA."
author: "Elena Suranova"
date: "2025-03-13"
output:
  html_document:
    df_print: paged
  pdf_document:
    latex_engine: xelatex
    keep_tex: true
always_allow_html: true
---
```{r}
options(repos = c(CRAN = "https://cran.rstudio.com/"))
```

# üìå –í–≤–µ–¥–µ–Ω–∏–µ

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ –≤–æ–¥—ã –≤ –ö–∞–ª–∏—Ñ–æ—Ä–Ω–∏–∏, –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –∏–∑ –ø–æ–ª–µ–≤—ã—Ö –∏ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã—Ö –∏–∑–º–µ—Ä–µ–Ω–∏–π.  
–û—Å–Ω–æ–≤–Ω—ã–µ —ç—Ç–∞–ø—ã:
- –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö  
- –í—ã—è–≤–ª–µ–Ω–∏–µ –≤—ã–±—Ä–æ—Å–æ–≤ 
- –ê–Ω–∞–ª–∏–∑ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–∞–∑–Ω—ã—Ö —Ö–∏–º–∏—á–µ—Å–∫–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –≤–æ–¥–µ  
- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ –∫–∞—Ä—Ç–µ  
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –Ω–æ—Ä–º–∞—Ç–∏–≤–∞–º–∏  

---

# –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```{r}
# –ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞–∫–µ—Ç–∞
library(webshot)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ PhantomJS
if (!webshot::is_phantomjs_installed()) {
  message("PhantomJS is not installed. Please install it before proceeding.")
}
```

```{r}
library(tidyverse)
```

```{r}
tinytex::is_tinytex()
```

```{r}
library(tidyverse)
library(data.table)
library(httr)
library(lubridate)
library(dplyr)
library(purrr)
```

```{r}
urls <- c(
  "https://data.cnra.ca.gov/dataset/3f96977e-2597-4baa-8c9b-c433cea0685e/resource/24fc759a-ff0b-479a-a72a-c91a9384540f/download/stations.csv",
  "https://data.cnra.ca.gov/dataset/3f96977e-2597-4baa-8c9b-c433cea0685e/resource/8ff3a841-d843-405a-a360-30c740cc8691/download/period_of_record.csv",  
  "https://data.cnra.ca.gov/dataset/3f96977e-2597-4baa-8c9b-c433cea0685e/resource/a9e7ef50-54c3-4031-8e44-aa46f3c660fe/download/lab_results.csv",
  "https://data.cnra.ca.gov/dataset/3f96977e-2597-4baa-8c9b-c433cea0685e/resource/1911e554-37ab-44c0-89b0-8d7044dd891d/download/field_results.csv"
)

download_and_load <- function(url) {
  temp_file <- tempfile(fileext = ".csv")  #  –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
  GET(url, write_disk(temp_file, overwrite = TRUE))  # –°–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª
  df <- fread(temp_file)  # –ó–∞–≥—Ä—É–∂–∞–µ–º –≤ R
  return(df)
}
```


```{r}
data_list <- lapply(urls, download_and_load)  # –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∫–æ –≤—Å–µ–º —Å—Å—ã–ª–∫–∞–º

# –†–∞–∑–±–∏—Ä–∞–µ–º —Ñ–∞–π–ª—ã –ø–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º
stations <- data_list[[1]]
period_of_record <- data_list[[2]]
lab_results <- data_list[[3]]
field_results <- data_list[[4]]

```

# üîÑ –û—á–∏—Å—Ç–∫–∞ –∏ –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

```{r}
str(stations)
colSums(is.na(stations))
sum(duplicated(stations))
```
–í—ã–±–∏—Ä–∞—é —Ç–æ–ª—å–∫–æ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–æ–ª–±—Ü–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã, —á—Ç–æ–±—ã –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ –∏ –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ –∏ —Å–æ—Å—Ç–∞–≤–∏—Ç—å —Å—Ö–µ–º—É —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —Å–æ–±–æ–π —Ç–∞–±–ª–∏—Ü –Ω–∞ –¥–æ—Å–∫–µ –ú–∏—Ä–æ. 

```{r}
column_names <- colnames(field_results)

# –í—ã–≤–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏–π —Å—Ç–æ–ª–±—Ü–æ–≤ 
print(column_names)
```
```{r}
column_names <- colnames(stations)

# –í—ã–≤–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏–π —Å—Ç–æ–ª–±—Ü–æ–≤
print(column_names)
```

```{r}
column_names <- colnames(period_of_record)

# –í—ã–≤–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏–π —Å—Ç–æ–ª–±—Ü–æ–≤
print(column_names)
```

```{r}
column_names <- colnames(lab_results)

# –í—ã–≤–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏–π —Å—Ç–æ–ª–±—Ü–æ–≤
print(column_names)
```



### 1. –ü—Ä–æ–≤–µ—Ä—è—é –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

–°–º–æ—Ç—Ä—é –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–ø—É—Å–∫–æ–≤ –ø–æ –∫–∞–∂–¥–æ–º—É —Å—Ç–æ–ª–±—Ü—É:

```{r}
colSums(is.na(stations))
colSums(is.na(period_of_record))
colSums(is.na(lab_results))
colSums(is.na(field_results))
# –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
# –í—ã–≤–æ–¥ —Å—É–º–º—ã –ø—Ä–æ–ø—É—Å–∫–æ–≤ –≤ –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü–µ
cat("Total NAs in stations:", sum(is.na(stations)), "\n")
cat("Total NAs in period_of_record:", sum(is.na(period_of_record)), "\n")
cat("Total NAs in lab_results:", sum(is.na(lab_results)), "\n")
cat("Total NAs in field_results:", sum(is.na(field_results)), "\n")
```
–ï—Å—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö —Å –ø—Ä–æ–ø—É—Å–∫–∞–º–∏, —Ç–∞–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ –æ —Å—Ç–∞–Ω—Ü–∏—è—Ö 278 –ø–æ–∑–∏—Ü–∏–π –±–µ–∑ –≥–µ–æ–¥–∞–Ω–Ω—ã—Ö 
–≤ —Ç–∞–±–ª–∏—Ü–µ –æ –ø–µ—Ä–∏–æ–¥–∞—Ö –∑–∞–ø–∏—Å–µ–π 10253 –ø–æ–∑–∏—Ü–∏–∏ –±–µ–∑ –≥–µ–æ–¥–∞–Ω–Ω—ã—Ö
–≤ —Ç–∞–±–ª–∏—Ü–µ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π 138 083 –ø–æ–∑–∏—Ü–∏–π –±–µ–∑ –≥–µ–æ–¥–∞–Ω–Ω—ã—Ö, –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –≥–ª—É–±–∏–Ω–µ –æ–±—Ä–∞–∑—Ü–∞ (sample_depth) –≤ 2 783 322 –∑–∞–ø–∏—Å—è—Ö (–Ω–æ —ç—Ç–æ—Ç –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å —è –≤ –∞–Ω–∞–ª–∏–∑–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ –ø–ª–∞–Ω–∏—Ä—É—é, –ø–æ—ç—Ç–æ–º—É —è –∏—Å–∫–ª—é—á—É –µ–≥–æ –∏–∑ –¥–∞–Ω–Ω—ã—Ö), —Ç–∞–∫–∂–µ –∫–∞–∫ reporting_limit, –≥–¥–µ 17 470 –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∑–∞–ø–∏—Å–∏.
–≤ —Ç–∞–±–ª–∏—Ü–µ –ø–æ–ª–µ–≤—ã—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π 12 219 –ø–æ–∑–∏—Ü–∏–∏ –±–µ–∑ –≥–µ–æ–¥–∞–Ω–Ω—ã—Ö, –µ—Å—Ç—å –º–Ω–æ–≥–æ –ø–æ–∑–∏—Ü–∏–π –≤ –∞–Ω–∞–ª–∏–∑–µ –±–µ–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ 130 748 (fdr_result) –∏ –±–µ–∑ –¥–∞—Ç—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (fdr_date_result) 1 203 611 –∏ –±–µ–∑  fdr_reporting_limit 180 787, —Ç–∞–∫–∂–µ –µ—Å—Ç—å 565 093 –ø—É—Å—Ç—ã—Ö –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Å—Ç–æ–ª–±—Ü–µ sample_depth, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

–†–∞—Å—Å–º–æ—Ç—Ä—é –≤–∞—Ä–∏–∞–Ω—Ç –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏—Å—Ö–æ–¥—è –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ –æ —Å—Ç–∞–Ω—Ü–∏—è—Ö, –∏—Å–∫–ª—é—á—É –∏–∑ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π —Å—Ç–∞–Ω—Ü–∏–∏ —É –∫–æ—Ç–æ—Ä—ã—Ö –æ—Ç—Å—Ç—É—Å—Ç–≤—É—é—Ç –∫–æ–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã, —ç—Ç–æ 278 —Å—Ç–∞–Ω—Ü–∏–π. 
```{r}
# –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞–Ω—Ü–∏–π –±–µ–∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
stations_clean <- stations %>% filter(!is.na(latitude) & !is.na(longitude))
station_ids_with_coords <- stations_clean$station_id

# –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥—Ä—É–≥–∏—Ö —Ç–∞–±–ª–∏—Ü –ø–æ station_id
period_of_record_clean <- period_of_record %>% filter(station_id %in% station_ids_with_coords)
lab_results_clean <- lab_results %>% filter(station_id %in% station_ids_with_coords)
field_results_clean <- field_results %>% filter(station_id %in% station_ids_with_coords)

# –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–Ω—É–∂–Ω—ã—Ö —Å—Ç–æ–ª–±—Ü–æ–≤
lab_results_clean <- lab_results_clean %>% select(-sample_depth, -reporting_limit)
field_results_clean <- field_results_clean %>% select(-fdr_reporting_limit, -sample_depth)

# –í—ã–≤–æ–¥ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –∑–∞–ø–∏—Å–µ–π
cat("Stations remaining:", nrow(stations_clean), "\n")
cat("Period of record remaining:", nrow(period_of_record_clean), "\n")
cat("Lab results remaining:", nrow(lab_results_clean), "\n")
cat("Field results remaining:", nrow(field_results_clean), "\n")

```
```{r}
colSums(is.na(stations_clean))
colSums(is.na(period_of_record_clean))
colSums(is.na(lab_results_clean))
colSums(is.na(field_results_clean))
# –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
# –í—ã–≤–æ–¥ —Å—É–º–º—ã –ø—Ä–æ–ø—É—Å–∫–æ–≤ –≤ –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü–µ
cat("Total NAs in stations:", sum(is.na(stations_clean)), "\n")
cat("Total NAs in period_of_record:", sum(is.na(period_of_record_clean)), "\n")
cat("Total NAs in lab_results:", sum(is.na(lab_results_clean)), "\n")
cat("Total NAs in field_results:", sum(is.na(field_results_clean)), "\n")
```



### 2. –ü—Ä–æ–≤–µ—Ä—è—é –¥—É–±–ª–∏–∫–∞—Ç—ã
–ï—Å–ª–∏ –µ—Å—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä (ID), –ø—Ä–æ–≤–µ—Ä—é –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è —Å—Ç—Ä–æ–∫–∏:
```{r}
sum(duplicated(stations_clean))
sum(duplicated(period_of_record_clean))
sum(duplicated(lab_results_clean))
sum(duplicated(field_results_clean))
```
–æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ 966 –¥—É–±–ª–∏–∫–∞—Ç–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ lab_results_clean
–∏ 44 –¥—É–±–ª–∏–∫–∞—Ç–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ field_results_clean

```{r}
lab_results_clean <- lab_results_clean %>% distinct()
field_results_clean <- field_results_clean %>% distinct()
```

–î—É–±–ª–∏–∫–∞—Ç–æ–≤ –Ω–µ—Ç. 


### 3. –ü—Ä–æ–≤–µ—Ä—è—é —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö

```{r}
str(stations_clean)
str(period_of_record_clean)
str(lab_results_clean)
str(field_results_clean)
```
–ò–º–µ–µ—é—Ç—Å—è —Ü–∏—Ñ—Ä–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å —Ç–µ–∫—Å—Ç–æ–≤—ã–º —Ç–∏–ø–æ–º –¥–∞–Ω–Ω—ã—Ö, —Ç–∞–∫–∏–µ –∫–∞–∫ result, sample_date_min –∏ –¥—Ä.
–µ—Å—Ç—å —á–∏—Å–ª–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∫–∞–∫ —Ç–µ–∫—Å—Ç

```{r}
sapply(stations_clean, class)
sapply(period_of_record_clean, class)
sapply(lab_results_clean, class)
sapply(field_results_clean, class)

```


## –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤
###  –î–µ–ª–∞—é –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã stations_clean
station_id	integer	integer	‚úÖ –û—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å (—ç—Ç–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞–Ω—Ü–∏–∏).
station_name	character	character	‚úÖ –û—Å—Ç–∞–≤–ª—è–µ–º (–Ω–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–∞–Ω—Ü–∏–∏).
full_station_name	character	character	‚úÖ –û—Å—Ç–∞–≤–ª—è–µ–º.
station_number	character	character	‚úÖ –û—Å—Ç–∞–≤–ª—è–µ–º.
station_type	character	factor	üîÑ –ú–µ–Ω—è–µ–º –Ω–∞ factor, —Ç–∞–∫ –∫–∞–∫ –µ—Å—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∑–Ω–∞—á–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, "Groundwater").
latitude	numeric	numeric	‚úÖ –û—Å—Ç–∞–≤–ª—è–µ–º (—à–∏—Ä–æ—Ç–∞).
longitude	numeric	numeric	‚úÖ –û—Å—Ç–∞–≤–ª—è–µ–º (–¥–æ–ª–≥–æ—Ç–∞).
county_name	character	factor	üîÑ –ú–µ–Ω—è–µ–º –Ω–∞ factor, —Ç–∞–∫ –∫–∞–∫ –æ–∫—Ä—É–≥–æ–≤ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ.
sample_count	integer	integer	‚úÖ –û—Å—Ç–∞–≤–ª—è–µ–º.
sample_date_min	character	Date (–∏–ª–∏ POSIXct)	üîÑ –ú–µ–Ω—è–µ–º –Ω–∞ Date/POSIXct, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –¥–∞—Ç—ã.
sample_date_max	character	Date (–∏–ª–∏ POSIXct)	üîÑ –ú–µ–Ω—è–µ–º –Ω–∞ Date/POSIXct, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –¥–∞—Ç—ã.

–ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º station_type –∏ county_name –≤ factor

```{r}
stations_clean$station_type <- as.factor(stations_clean$station_type)
stations_clean$county_name <- as.factor(stations_clean$county_name)
```

–ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º sample_date_min –∏ sample_date_max –≤ —Ñ–æ—Ä–º–∞—Ç Date –∏–ª–∏ POSIXct
–§–æ—Ä–º–∞—Ç –¥–∞—Ç –≤ –¥–∞–Ω–Ω—ã—Ö: "06/23/2008 15:00" ‚Üí mm/dd/yyyy HH:MM
–ò—Å–ø–æ–ª—å–∑—É–µ–º lubridate::mdy_hm() –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –≤ POSIXct (–¥–∞—Ç–∞ + –≤—Ä–µ–º—è):

```{r}  
stations_clean$sample_date_min <- mdy_hm(stations_clean$sample_date_min)
stations_clean$sample_date_max <- mdy_hm(stations_clean$sample_date_max)
```

–ï—Å–ª–∏ –≤—Ä–µ–º—è –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –∏ –Ω—É–∂–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–∞—Ç–∞, –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å Date:
```{r} 
stations_clean$sample_date_min <- as.Date(stations_clean$sample_date_min)
stations_clean$sample_date_max <- as.Date(stations_clean$sample_date_max)
```

### –¢–∞–∫–∏–µ –∂–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –ø—Ä–æ–≤–æ–∂—É –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ç–∞–±–ª–∏—Ü

–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã lab_results__clean
–°—Ç–æ–ª–±–µ—Ü	–¢–µ–∫—É—â–∏–π —Ç–∏–ø	–ù–æ–≤—ã–π —Ç–∏–ø	–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ
station_id	integer	integer	‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
station_name	character	character	‚úÖ –ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–∞–Ω—Ü–∏–∏
full_station_name	character	character	‚úÖ –ü–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
station_number	character	character	‚úÖ –ù–æ–º–µ—Ä —Å—Ç–∞–Ω—Ü–∏–∏
station_type	character	factor	üîÑ –¢–∏–ø —Å—Ç–∞–Ω—Ü–∏–∏ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫)
latitude	numeric	numeric	‚úÖ –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è —à–∏—Ä–æ—Ç–∞
longitude	numeric	numeric	‚úÖ –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –¥–æ–ª–≥–æ—Ç–∞
county_name	character	factor	üîÑ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –æ–∫—Ä—É–≥–æ–≤
sample_date	character	Date	üîÑ –î–∞—Ç–∞ –ø—Ä–æ–±—ã
result	character	numeric	üîÑ –†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞ (–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –∏ –æ—á–∏—â–∞–µ–º –æ—Ç "ND", "Trace")
```{r} 
# –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤
lab_results_clean$station_type <- as.factor(lab_results_clean$station_type)
lab_results_clean$county_name <- as.factor(lab_results_clean$county_name)

# –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞—Ç
lab_results_clean$sample_date <- as.Date(mdy_hm(lab_results_clean$sample_date))

```

–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã field_results_clean

–°—Ç–æ–ª–±–µ—Ü	–¢–µ–∫—É—â–∏–π —Ç–∏–ø	–ù–æ–≤—ã–π —Ç–∏–ø	–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ
station_id	integer	integer	‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
station_name	character	character	‚úÖ –ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–∞–Ω—Ü–∏–∏
station_number	character	character	‚úÖ –ù–æ–º–µ—Ä —Å—Ç–∞–Ω—Ü–∏–∏
full_station_name	character	character	‚úÖ –ü–æ–ª–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
station_type	character	factor	üîÑ –¢–∏–ø —Å—Ç–∞–Ω—Ü–∏–∏ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫)
latitude	numeric	numeric	‚úÖ –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è —à–∏—Ä–æ—Ç–∞
longitude	numeric	numeric	‚úÖ –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –¥–æ–ª–≥–æ—Ç–∞
county_name	character	factor	üîÑ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –æ–∫—Ä—É–≥–æ–≤
sample_date	POSIXct	POSIXct	‚úÖ –í—Ä–µ–º—è –ø—Ä–æ–±—ã —É–∂–µ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
parameter	character	factor	üîÑ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (pH, –∫–∏—Å–ª–æ—Ä–æ–¥ –∏ –¥—Ä.)
fdr_result	numeric	numeric	üîÑ –û—á–∏—â–∞–µ–º –æ—Ç –≤—ã–±—Ä–æ—Å–æ–≤

```{r} 
# –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤
field_results_clean$station_type <- as.factor(field_results_clean$station_type)
field_results_clean$county_name <- as.factor(field_results_clean$county_name)
field_results_clean$parameter <- as.factor(field_results_clean$parameter)


```

–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã period_of_record_clean
–ß—Ç–æ –º–µ–Ω—è–µ–º?

–°—Ç–æ–ª–±–µ—Ü	–¢–µ–∫—É—â–∏–π —Ç–∏–ø	–ù–æ–≤—ã–π —Ç–∏–ø	–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ
station_id	integer	integer	‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
station_name	character	character	‚úÖ –ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–∞–Ω—Ü–∏–∏
sample_date_min	character	Date	üîÑ –î–∞—Ç–∞ –ø–µ—Ä–≤–æ–π –ø—Ä–æ–±—ã
sample_date_max	character	Date	üîÑ –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ–±—ã

```{r} 
# –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞—Ç
period_of_record_clean$sample_date_min <- as.Date(mdy_hm(period_of_record_clean$sample_date_min))
period_of_record_clean$sample_date_max <- as.Date(mdy_hm(period_of_record_clean$sample_date_max))

```

### –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–±–µ–ª–æ–≤ –∏ –ø—Ä–æ–ø—É—Å–∫–æ–≤

–ø–æ—Å–º–æ—Ç—Ä—é —Å–∫–æ–ª—å–∫–æ –∑–Ω–∞—á–µ–Ω–∏–π –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–æ –≤ —Ç–∞–±–ª–∏—Ü–µ lab_results_clean

```{r}
# –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–Ω–∞—á–µ–Ω–∏–π –≤ —Å—Ç–æ–ª–±—Ü–µ result
total_values <- nrow(lab_results_clean)

# –ü–æ–¥—Å—á–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–Ω–∞—á–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω—ã –≤ NA
num_converted <- sum(lab_results_clean$result %in% c("ND", "Trace", ""))

# –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
cat("Total values in 'result':", total_values, "\n")
cat("Values converted to NA:", num_converted, "\n")
```
```{r}

# –û—á–∏—Å—Ç–∫–∞ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ 
lab_results_clean <- lab_results_clean %>%
  mutate(result = as.numeric(ifelse(result %in% c("ND", "Trace", "other_text"), NA, result))) %>%
  filter(!is.na(result))


```

```{r}
#–ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
unique_values <- unique(lab_results_clean$result)

```

—Ç–∞–∫–∏–º –∂–µ –æ–±—Ä–∞–∑–æ–º –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è 3 –¥—Ä—É–≥–∏–µ —Ç–∞–±–ª–∏—Ü—ã

```{r}
# –û—á–∏—Å—Ç–∫–∞ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–ª—è stations_clean
stations_clean <- stations_clean %>%
  mutate(latitude = as.numeric(ifelse(latitude %in% c("ND", "Trace", "other_text"), NA, latitude))) %>%
  filter(!is.na(latitude))

# –û—á–∏—Å—Ç–∫–∞ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–ª—è period_of_record_clean
period_of_record_clean <- period_of_record_clean %>%
  mutate(latitude = as.numeric(ifelse(latitude %in% c("ND", "Trace", "other_text"), NA, latitude))) %>%
  filter(!is.na(latitude))

# –û—á–∏—Å—Ç–∫–∞ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–ª—è field_results_clean
field_results_clean <- field_results_clean %>%
  mutate(fdr_result = as.numeric(ifelse(fdr_result %in% c("ND", "Trace", "other_text"), NA, fdr_result))) %>%
  filter(!is.na(fdr_result))
```

–°—Ä–∞–≤–Ω—é —Å–∫–æ–ª—å–∫–æ –±—ã–ª–æ —Å—Ç—Ä–æ–∫ –≤ –∏—Å—Ö–æ–¥–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö –∏ —Å–∫–æ–ª—å–∫–æ —Å—Ç–∞–ª–æ —Ç–µ–ø–µ—Ä—å –ø–æ—Å–ª–µ –≤—Å–µ—Ö –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π –∏ –æ—á–∏—Å—Ç–∫–∏.

```{r}
# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –≤ –∏—Å—Ö–æ–¥–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
initial_stations_rows <- nrow(stations)
initial_period_of_record_rows <- nrow(period_of_record)
initial_lab_results_rows <- nrow(lab_results)
initial_field_results_rows <- nrow(field_results)
```

```{r}
# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏
final_stations_rows <- nrow(stations_clean)
final_period_of_record_rows <- nrow(period_of_record_clean)
final_lab_results_rows <- nrow(lab_results_clean)
final_field_results_rows <- nrow(field_results_clean)

# –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
cat("Stations: initial =", initial_stations_rows, ", final =", final_stations_rows, "\n")
cat("Period of Record: initial =", initial_period_of_record_rows, ", final =", final_period_of_record_rows, "\n")
cat("Lab Results: initial =", initial_lab_results_rows, ", final =", final_lab_results_rows, "\n")
cat("Field Results: initial =", initial_field_results_rows, ", final =", final_field_results_rows, "\n")
```
–ø–æ–ª—É—á–∏–ª–∞: 
Stations: initial = 44604 , final = 44326 
Period of Record: initial = 739214 , final = 728961 
Lab Results: initial = 4658743 , final = 3666231 
Field Results: initial = 1208351 , final = 1021931



# üìç –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–∞ –∏–∑–º–µ—Ä–µ–Ω–∏–π

## –ö–∞—Ä—Ç–∞ —Å—Ç–∞–Ω—Ü–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
```{r}
library(ggplot2)

library(ggmap)
```

#### –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞—é, —á—Ç–æ stations_clean —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—á–∏—â–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏

### –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã —Å Google Maps —Ç–µ–ø–µ—Ä—å —Ç—Ä–µ–±—É–µ—Ç API –∫–ª—é—á –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–∞—Ä—Ç –∏ OpenStreetMap —Ç–æ–∂–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ, –Ω–µ–æ–±—Ö–æ–¥–∏–º API –∫–ª—é—á
map <- get_map(location = c(lon = mean(stations_clean$longitude, na.rm = TRUE), 
                            lat = mean(stations_clean$latitude, na.rm = TRUE)), 
               zoom = 6, source = "osm", maptype = "terrain")

## –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã —Å —Ç–æ—á–∫–∞–º–∏
ggmap(map) +
  geom_point(data = stations_clean, aes(x = longitude, y = latitude), 
             color = "red", alpha = 0.5, size = 2) +
  labs(title = "–ö–∞—Ä—Ç–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –≤–æ–¥—ã",
       x = "–î–æ–ª–≥–æ—Ç–∞", y = "–®–∏—Ä–æ—Ç–∞")
       
       
–ø–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑—É—é –ø–∞–∫–µ—Ç "leaflet"


```{r}
library(leaflet)

# –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã
leaflet(data = stations_clean) %>%
  addTiles() %>%  # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–≤–æ–π –∫–∞—Ä—Ç—ã
  addCircleMarkers(~longitude, ~latitude, 
                   color = "red", 
                   radius = 5, 
                   fillOpacity = 0.5,
                   popup = ~station_name) %>%
  addLegend("bottomright", colors = "red", labels = "Stations", title = "Legend")

```



–ù–∞ –ø–æ–ª—É—á–µ–Ω–æ–π –∫–∞—Ä—Ç–µ —è –æ–±–Ω–∞—Ä—É–∂–∏–ª–∞ —Ç–æ—á–∫—É –¥–∞–ª–µ–∫–æ –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –ö–∞–ª–∏—Ñ–æ—Ä–Ω–∏–∏
–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–±—Ä–æ—Å–æ–≤ –Ω–∞ –∫–∞—Ä—Ç–µ. –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ö–∞–ª–∏—Ñ–æ—Ä–Ω–∏–∏ –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–∏–µ: –®–∏—Ä–æ—Ç–∞ (Latitude): 32.5 ‚Äî 42.0. –î–æ–ª–≥–æ—Ç–∞ (Longitude): -124.5 ‚Äî -114.0, 

–ü—Ä–æ–≤–µ—Ä—è—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —à–∏—Ä–æ—Ç–µ –∏ –¥–æ–ª–≥–æ—Ç–µ
```{r}
library(dplyr)

# –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ö–∞–ª–∏—Ñ–æ—Ä–Ω–∏–∏
stations_clean <- stations_clean %>%
  filter(latitude >= 32.5 & latitude <= 42.0,
         longitude >= -124.5 & longitude <= -114.0)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
summary(stations_clean$latitude)
summary(stations_clean$longitude)
```


## –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
–ß—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —ç—Ç–∏ —Ç–∞–±–ª–∏—Ü—ã, —Å–æ—Ö—Ä–∞–Ω—è—é –∏—Ö –≤ —Ñ–æ—Ä–º–∞—Ç–µ RDS, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –±–∏–Ω–∞—Ä–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏—Ö –æ–±—Ä–∞—Ç–Ω–æ.
```{r}
saveRDS(stations_clean, "stations_clean.RDS")
saveRDS(period_of_record_clean, "period_of_record_clean.RDS")
saveRDS(lab_results_clean, "lab_results_clean.RDS")
saveRDS(field_results_clean, "field_results_clean.RDS")
```

–¢–µ–ø–µ—Ä—å –µ—Å—Ç—å —á–µ—Ç—ã—Ä–µ —Ñ–∞–π–ª–∞ RDS, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ –æ—á–∏—â–µ–Ω–Ω—ã–µ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã. 
–ß—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏—Ö –æ–±—Ä–∞—Ç–Ω–æ –≤ R, –∏—Å–ø–æ–ª—å–∑—É—è —Ñ—É–Ω–∫—Ü–∏—é readRDS().

# –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∞–±–ª–∏—Ü
stations_clean <- readRDS("stations_clean.RDS")
period_of_record_clean <- readRDS("period_of_record_clean.RDS")
lab_results_clean <- readRDS("lab_results_clean.RDS")
field_results_clean <- readRDS("field_results_clean.RDS")



